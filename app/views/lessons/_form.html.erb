<%= simple_form_for(@lesson) do |f| %>

  <% if @lesson.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(@lesson.errors.count, "error") %> prohibited this lesson from being saved:</h2>

      <ul class="main">
      <% @lesson.errors.full_messages.each do |message| %>
        <li><%= message %></li>
      <% end %>
      </ul>
    </div>
  <% end %>
  <header class="header--secondary">
    <div class="wrapper--flex">
      <%if @lesson.title.present?%>
        <h2><%= @lesson.title%></h2>
      <% else %>
        <h2>Create a Lesson</h2>
      <% end %>
      <div class="actions right">
        <% if current_user.admin? && @lesson.submitted%>
          <%= f.submit "Update", class: "button button--secondary save-as-draft" %>
           <div class="slideThree"> 
             <%= f.check_box :approved, data: @lesson.id, class: "lesson_approved_check", id: "slideThree#{@lesson.id}" %>
             <label for="slideThree<%= @lesson.id %>"></label>
           </div>
        <% end %>
        <% if !@lesson.submitted%>
          <%= f.submit "Save as Draft", class: "button button--secondary save-as-draft" %>
        <% end %>

        <% if @lesson.id.present? && !@lesson.submitted%>
          <%= link_to edit_lesson_path(@lesson, submitted: true), remote: true,  method: :get, class: 'button button--primary submit-button' do %>
           Submit
          <% end %>
        <% elsif !@lesson.submitted%>
          <%= f.hidden_field :submitted, value: true %>  
          <%= f.submit "Submit Lesson", class: "button button--primary" %>  
        <% end %>
      </div>
    </div>
  </header>
  <%if current_user.admin? && @lesson.id.present?%>
    <div class="lesson--admin-edit wrapper--flex">
      <div class="lesson--admin-edit-author"> 
        <label for="author">Author:</label>
        <input type="text" disabled value="<%= @lesson.author%>">
      </div>
      <div class="lesson--admin-edit-color">
        <%= f.label :custom_color, 'Custom Lesson Colour:'%>
        <%= f.text_field :custom_color %>
        <span class="color-swatch" style="background:<%= @lesson.custom_color%>;"></span>
      </div>
      <div class="lesson--admin-edit-verified">
        <%= f.label :verified, 'Lesson Verified?'%>
        <div class="select">
          <%= f.select :verified, [['Yes', true], ['No', false]] %>
        </div>
      </div>
      <div class="lesson--admin-edit-message">
        <%= f.label :verification_message, 'Badge Verification Message'%>
        <span class="label-direction">(30 characters maximum)</span>
        <div class="wrapper--flex">
          <span class="message-for">This lesson is verified for...</span>
          <%= f.text_field :verification_message, placeholder: 'The Provincial Curriculum' %>
        </div>
      </div>
    </div>
  <% end %>
  <div class="wrapper--flex">
    <div class="content">
      <h3 class="title--tertiary required">Lesson Info</h3>
      <%= f.label :title, class: 'required'%>
      <%= f.text_field :title %>
      <div class="wrapper--flex flex-even">
        <div>  
         <%= f.label :grade %>
        <div class="select"> 
          <%= f.select :grade, options_for_select(Lesson::GRADE, @lesson.grade), {:include_blank => 'Choose'}%>
        </div>
        </div>
        <div>
          <%= f.label :duration_in_minutes %>
          <%= f.number_field :duration_in_minutes %>
        </div>
      </div>

      <div>
        <h3 class="title--tertiary required">Short Summary</h3>
        <p class="small">Write a brief summary to introduce your lesson and provide context. This will appear on the main lesson dashboard as well as the top of your lesson page.</p>
        <%= f.text_area :description, placeholder: 'Write a short summary here' %>
      </div>
      <div>
        <h3 class="title--tertiary">Prep Work</h3>
        <p class="small">All the behind the scenes work to get the lesson ready.</p>
        <%= f.bootsy_area :prep, placeholder: 'Indicate any prep work required for this lesson, including any materials etc.' %>
      </div>
      <div class="textarea-content">
        <h3 class="title--tertiary required">The Lesson</h3>
        <p class="small">The actual meat of the lesson! This could take form of a step by step guide or maybe a series of little exercises, completely up to you!</p>
        <%= f.bootsy_area :content, placeholder: 'Write the content of your lesson, including all lecture notes and hands-on activity instructions here.', required: true %>
      </div>
      <div>
        <h3 class="title--tertiary">Assessment</h3>
        <p class="small">Either then answers to problems that are asked in the lesson or a guideline for some potential results of lesson completion.</p>
        <%= f.bootsy_area :answers, placeholder: 'Provide answers here.' %>
      </div>
      <div>
        <h3 class="title--tertiary">Extensions</h3>
        <p class="small">Additional questions and challenges that build on content reviewed in the lesson.</p>
        <%= f.bootsy_area :extensions, placeholder: 'Provide extensions here.' %>
      </div>
      <%= f.label :file_upload %>
      <p class="small">Upload additonal learning materials, reading, or slides.</p>
      <%= f.file_field :file_upload %>
      <%= f.label :video_link %>
      <p class="small">The embed link for any video material you may have that goes along with the lesson</p>
      <%= f.text_field :video_link, placeholder: 'Add link to video here' %>
      <% if !@lesson.submitted %>
        <%= f.submit "Save as Draft", class: "button button--secondary save-as-draft" %>
      <% end %>
      <% if @lesson.id.present? && !@lesson.submitted%>
        <%= link_to edit_lesson_path(@lesson, submitted: true), remote: true,  method: :get, class: 'button button--primary submit-button' do %>
         Submit
        <% end %>
        <%= link_to 'delete lesson', lesson_path(@lesson),
    data: { confirm: 'Are you sure you want to delete this lesson?' }, method: :delete, class: 'link--underlined delete-lesson'%>
      <% elsif !@lesson.submitted%>
        <%= hidden_field_tag submitted: true %>  
        <%= f.submit "Submit Lesson", class: "button button--primary" %>
      <% end %>
    </div>
    <!-- BEGINING OF SIDEBAR -->
    <div class="sidebar">
      <%= f.label 'Intended Province', :province, class: 'required'%>
      <div class="select"> 
        <%= f.select :province, options_for_select(Lesson::PROVINCES, @lesson.province)%>
      </div>
      <% if @lesson.feature_image.present? %>
        <%= image_tag @lesson.feature_image.url(:medium)%>
      <% end %>
      <%= f.label :feature_image, class: 'required' %>
      <%= f.file_field :feature_image, required: true %>
      <!-- TODO make semantic ui work -->
      <%= f.label 'Curriculum Subjects', :subject_list, class: 'required'%>
      <%= f.select :subject_list, options_for_select(Lesson::CURRICULUM_SUBJECTS, @lesson.subject_list), {class: 'ui fluid dropdown selection multiple', multiple: true}  %>
      <div>
        <%= f.label 'Curriculum Takeaways', :curriculum_concepts, class: 'required'%>
        <p class="small">An optional text field should you want to expand upon the curriculum subjects covered in the lesson.</p>
        <%= f.bootsy_area :curriculum_concepts, placeholder: 'Add any curriculum takeaways here.' %>
      </div>
      <%= f.label 'Coding Concepts', :code_concept_list, class: 'required' %>
      <%= f.select :code_concept_list, options_for_select(Lesson::CODING_CONCEPTS, @lesson.code_concept_list), {class: 'ui fluid dropdown selection multiple', multiple: true}  %>
      <div>
        <%= f.label 'Coding Takeaways', :programming_concepts%>
        <p class="small">An optional text field should you want to expand upon the coding concepts covered in the lesson.</p>
        <%= f.bootsy_area :programming_concepts, placeholder: 'Add any coding takeaways here.' %>
      </div>
     
      <h3>Tags</h3>
      <p class="small">Add comma seperated tags for associated curriculum subjects and programming concepts (Ex. Math, English OR Javascript, Conditional Statements)</p>
     

      <%= f.input :code_concept_list, :label => 'Programming concept', :url => autocomplete_code_concept_name_lessons_path, :as => :autocomplete, input_html: {value: @lesson.code_concept_list.to_s, 'data-delimiter' => ','} %>


   

      <div class="levels">
        <%= f.label :level %><br>
        <p class="small">An indicator of the difficulty of the lesson. Could be related to programming concepts or curriculum concepts covered.</p>
        <%= f.radio_button :level, '1', :checked => true %><span>1</span><br>
        <%= f.radio_button :level, '2' %><span>2</span><br>
        <%= f.radio_button :level, '3' %><span>3</span><br>
        <%= f.radio_button :level, '4' %><span>4</span><br>
      </div>
      <div>
        <h3>References</h3>
        <p class="small">List any references you used or found useful in the creation of this lesson.</p>
        <%= f.bootsy_area :references %>
      </div>
      <% if current_user.profile.is_admin? %>
      <div>
        <h3>Suggested Lessons</h3>
        <p class="small">Lessons that would nicely complement this one or provide a good extension.</p>
        <% if @lesson.suggested_lessons.present?%>
          <ul>
            <%@lesson.suggested_lessons.each do |sug_lesson|%>
              <% if sug_lesson.suggested_lesson_id > 0%>
                <% the_lesson = Lesson.where(id: sug_lesson.suggested_lesson_id.to_i).first%>
                  <li id="sug_<%= sug_lesson.id%>"><%= link_to the_lesson.title, lesson_path(the_lesson) %> |      <%= link_to 'Delete', sug_lesson, method: :delete, data: { confirm: 'Are you sure?' }, :remote => true %></li>
              <% end %>
        
            <% end %>
          </ul>
        <% end %>
          <%= f.collection_check_boxes :suggested_lessons, Lesson.all, :id, :title, {:include_blank => false}  %>
      </div>
      <% end %>

    </div>
  </div>
<% end %>

<script>
  function ajaxSubmitInput(elem) {
    console.log(elem)
    // $.ajax({
    //   url: '',  
    //   method: 'GET', 
    //   data: data
    // });
  }
</script>