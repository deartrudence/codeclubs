<style>
  .custom-color-bg {
    background:<%= @lesson.custom_color %> !important;
  }

  .custom-color-text {
    color: <%= @lesson.custom_color %> !important;
  }
  
  a.custom-color-text:hover {
    border-bottom: 2px solid <%= @lesson.custom_color %>!important;
  }
  .custom-color-title {
    color: <%= @lesson.custom_color %>;
    border-color: <%= @lesson.custom_color %>!important;
  }

  .lesson--section-title {
    color:<%= @lesson.custom_color %>!important;
    border-bottom-color: <%= @lesson.custom_color %>!important;
  }
  .lesson--section-title:after {
    color:<%= @lesson.custom_color %>!important;
  }

  .lesson--section-title:hover {
    color:white !important;
    background: <%= @lesson.custom_color %>!important;
  }

  .lesson--section-title:hover:after {
    color:white !important;
  }

  .lesson--section-title.active {
    color:white !important;
    background: <%= @lesson.custom_color %>!important;
  }
</style>
<%if notice.present?%>
  <p id="notice"><%= notice %></p>
<% end %>  

<div class="wrapper wrapper--flex wrapper--flex-wrap as--lesson-wrapper lesson--single-title">
  <div class="lesson--single-title-bar custom-color-bg">
    <h2 class="as--no-top-margin"><%= @lesson.title %></h2>
    <h4 class="font-quicksand as--no-top-margin"><% if @lesson.grade.present?%><%= t('dictionary.grade-level') %> <%= @lesson.grade%> â€¢ <% end %><%= @lesson.duration_in_minutes%> <%= t('lessons.single.duration') %></h4>
    <h3 class="font-quicksand as--no-top-margin"><%= t('lessons.single.created-by') %> <%= link_to @lesson.author, profile_path(@lesson.user.profile)%> <%= t('lessons.single.created-by-second') %> <%= @lesson.format_date(@lesson.created_at)%></h3>
  </div>
  <div class="lesson--single-title-img" style="background-image: url(<%= @lesson.feature_image.url(:medium) %>)">
  </div>
</div> 
<div id="sticky-nav-target"></div>
<div class="wrapper wrapper--flex wrapper--flex-wrap as--lesson-wrapper" id="lesson--nav-bar">
  <nav class="lesson--nav">
    <p><%= t('lessons.single.jump-to') %></p>
    <ul>
      <li><a href="#introduction" class="custom-color-text"><%= t('lessons.single.intro') %></a></li>
      <li><a href="#prep-work" class="custom-color-text"><%= t('lessons.prep') %></a></li>
      <li><a href="#the-lesson" class="custom-color-text"><%= t('lessons.the-lesson') %></a></li>
      <li><a href="#extensions" class="custom-color-text"><%= t('lessons.extenstions') %></a></li>
      <li><a href="#answers" class="custom-color-text"><%= t('lessons.assessment') %></a></li>
      <li><a href="#suggested-lessons" class="custom-color-text"><%= t('lessons.suggested-lesson') %></a></li>
    </ul>
  </nav>
  <nav class="lesson--single-share">
    <div>
      <p><%= t('lessons.single.share-lesson') %></p>
      <div class="wrapper--flex">
        <a class="twitter-share-button"
          href="https://twitter.com/intent/tweet?text=Hello%20world">
        <%= t('lessons.single.tweet') %></a>
        <a href="" class="share-email"><i class="fa fa-envelope" aria-hidden="true"></i> <%= t('lessons.single.email') %></a>
        <div class="fb-share-button" data-href="<%=request.url%>" data-layout="button" data-size="small" data-mobile-iframe="true"><a class="fb-xfbml-parse-ignore" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=<%=request.url%>"><%= t('lessons.single.share') %></a></div>
      </div>
    </div>
  </nav>
</div>
<div class="wrapper wrapper--flex wrapper--flex-wrap as--lesson-wrapper">
  <div class="lesson--single-text">
    <section>
      <h3 class="lesson--section-title" id="introduction"><%= t('lessons.single.intro') %></h3>
      <div class="text-edit">
        <%= @lesson.description.html_safe%>
      </div>
    </section>
    <% if @lesson.prep.present? %>
      <section>
        <h3 class="lesson--section-title" id="prep-work"><%= t('lessons.prep') %></h3>
        <div class="text-edit">
          <%= @lesson.prep.html_safe %>
        </div>
      </section>
    <% end %>
    <section> 
      <h3 class="lesson--section-title" id="the-lesson"><%= t('lessons.the-lesson') %></h3>
      <div class="text-edit">
        <%= @lesson.content.html_safe %>
      </div>
    </section>
    <% if @lesson.extensions.present? %>
      <section>
        <h3 class="lesson--section-title" id="extensions"><%= t('lessons.extenstions') %></h3>
        <div class="text-edit">
          <%= @lesson.extensions.html_safe %>
        </div>
      </section>
    <% end %>
    <% if @lesson.answers.present? %>
      <section> 
        <h3 class="lesson--section-title" id="answers"><%= t('lessons.assessments') %></h3>
        <div class="text-edit">
          <%= @lesson.answers.html_safe %>
        </div>
      </section>
    <% end %>
    <% if @lesson.video_link.present?%>
        <%= @lesson.video_link.html_safe %>
    <% end %>
    <% if @lesson.file_upload.file? %>
      <%= link_to 'download additional materials', @lesson.file_upload.url, target: '_blank', class: 'button button--secondary' %>
    <% end %>
    <% if @lesson.suggested_lessons.present? %>
      <section>
        <h3 class="lesson--section-title" id="suggested-lessons"><%= t('lessons.suggested-lesson') %></h3>
        <div class="text-edit">
          <ul> 
            <% @lesson.suggested_lessons.each do |sug_lesson|%>
              <% if sug_lesson.suggested_lesson_id > 0%>
                <% the_lesson = Lesson.where(id: sug_lesson.suggested_lesson_id.to_i).first%>
                  <li><%= link_to the_lesson.title, lesson_path(the_lesson) %></li>
              <% end %>
            <% end %> 
          </ul>
        </div>
      </section>
    <% end %>
  </div>
  <div class="lesson--single-sidebar">
    <!-- <%= image_tag @lesson.feature_image.url(:medium) %> -->
    <div class="lesson--single-sidebar--text word-wrap">
      <ul class="list--tags">
        <li class="title"><%= t('dictionary.subjects') %>:</li>
        <% @lesson.subject_list.each do |subject| %>
          <li class="custom-color-bg"><%= subject %></li>
        <% end %>
      </ul>
      <ul class="list--tags">
        <li class="title"><%= t('dictionary.coding-concepts') %>:</li>
        <% @lesson.code_concept_list.each do |code_concept| %>
          <li class="custom-color-bg"><%= code_concept %></li>
        <% end %>
      </ul>
      <% if @lesson.curriculum_concepts.present? %>
        <h3>Key Curriculum Concepts</h3>
        <div class="text-edit">
          <%= @lesson.curriculum_concepts.html_safe %>
        </div>
      <% end %>

      <% if @lesson.programming_concepts.present? %>
        <h3>Key Coding Concepts</h3>
        <div class="text-edit">
          <%= @lesson.programming_concepts.html_safe %>
        </div>
      <% end %>

      
      <% if @lesson.references.present? %>
        <h3><%= t('dictionary.references') %></h3>
        <div class="text-edit">
          <%= @lesson.references.html_safe %>
        </div>
      <% end %>

    </div>
  </div>
</div>  


<script>
  var centerStickyNav = function(nav){
    var windowWidth = $(window).innerWidth()
    var navWidth = $(nav).width()

    var leftMargin = (windowWidth - navWidth) / 2

    $(nav).css('left', leftMargin)
  }
  function sticky_relocate() {
      var window_top = $(window).scrollTop();
      var div_top = $('#sticky-nav-target').offset().top;
      if (window_top > div_top) {
          $('#lesson--nav-bar').addClass('lesson--nav-bar-sticky');
          $('#sticky-nav-target').height($('#lesson--nav-bar').outerHeight());
          centerStickyNav($('#lesson--nav-bar'))
      } else {
          $('#lesson--nav-bar').removeClass('lesson--nav-bar-sticky');
          $('#sticky-nav-target').height(0);
          $('#lesson--nav-bar').css('left', 0)
      }
  }

  $(function(){ 
    $('.lesson--section-title').on('click', function(){
      $(this).siblings('.text-edit').slideToggle('100')
      $(this).toggleClass('active')
    })
    $(window).scroll(sticky_relocate);
    sticky_relocate();
  })

  $(function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.8&appId=965856376884950";
    fjs.parentNode.insertBefore(js, fjs);
  }(document, 'script', 'facebook-jssdk'));
</script>

<script>window.twttr = (function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0],
    t = window.twttr || {};
  if (d.getElementById(id)) return t;
  js = d.createElement(s);
  js.id = id;
  js.src = "https://platform.twitter.com/widgets.js";
  fjs.parentNode.insertBefore(js, fjs);

  t._e = [];
  t.ready = function(f) {
    t._e.push(f);
  };

  return t;
}(document, "script", "twitter-wjs"));</script>


