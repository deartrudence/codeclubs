<div class="wrapper">
	<h1 class="as--admin-title">My Lesson Dashboard</h1>
  <ul class="tabs wrapper--flex">
    <li class="tab-link" data-tab="drafts-tab">Drafts</li>
    <li class="tab-link" data-tab="submitted-tab">Submitted</li>
    <li class="tab-link" data-tab="bookmarked-lessons-tab">Bookmarked Lessons</li>
  </ul>
  <div class="tab-content" id="drafts-tab">
    <% if @lesson_drafts.present? %>
      <%= render 'lesson_drafts', locals: {lessons: @lesson_drafts}%>
    <% end %>
  </div>
  <div class="wrapper--flex tab-content" id="submitted-tab">
    <% if @lesson_submitted.present? %>
      <%= render 'lesson', locals: {lessons: @lesson_submitted}%>
    <% end %>
  </div>
  <div class="wrapper--flex tab-content" id="my-lessons-tab">
  <% if @lessons.present? %>
    <%= render 'lesson', locals: {lessons: @lessons}%>
  <% else %>
    <p>You haven't made any lessons yet.  Create one <%= link_to 'here', new_lesson_path %></p>
  <% end %>
  </div>
  <div class="wrapper--flex tab-content" id="bookmarked-lessons-tab">
  <% if @lesson_bookmarked.present? %>
    <%= render 'lesson', locals: {lessons: @lesson_bookmarked}%>
  <% else %>
    <p>You haven't added any favourites yet.  Add one <%= link_to 'here', lessons_path %></p>
  <% end %>
  </div>
</div>



<script>
  function updateHash() {
    if (window.location.hash){
      var tab_id = getHashParams()['tab']
      var data = getHashParams()
      $('ul.tabs li').removeClass('current');
      $('.tab-content').removeClass('current');
      $('[data-tab="'+ tab_id + '"]').addClass('current');
      $("#"+tab_id).addClass('current');
      $.ajax({
        url: '', 
        method: 'GET', 
        dataType: 'json',
        data: data
      })
    }
  }

  function getHashParams() {
    var hashParams = {};
    var e,
        a = /\+/g,  // Regex for replacing addition symbol with a space
        r = /([^&;=]+)=?([^&;]*)/g,
        d = function (s) { return decodeURIComponent(s.replace(a, " ")); },
        q = window.location.hash.substring(1);

    while (e = r.exec(q))
       hashParams[d(e[1])] = d(e[2]);

    return hashParams;
  }


  $('ul.tabs li').click(function(){
    var tab_id = $(this).attr('data-tab');
    window.location.hash = 'tab=' + tab_id
  })
  $(window).on('hashchange', function(){
   updateHash();
  })

  $(document).on('ready page:load', function(){
    updateHash();
  })


</script>