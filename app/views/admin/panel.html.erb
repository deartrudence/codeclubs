<div class="wrapper">

  <h1>Admin</h1>

  <ul class="tabs">
    <li class="tab-link current" data-tab="lessons-tab">Lessons</li>
    <li class="tab-link" data-tab="users-tab">Users</li>
    <li class="tab-link" data-tab="mailing-tab">Mailing List</li>
  </ul>

  <div id="lessons-tab" class="tab-content current">
    <h2>Lessons</h2>
    <%= form_tag(admin_path, method: :get, remote: true) do %>
      <%= select_tag :filter, options_for_select([ "all","approved", "unapproved" ], "all"), class: "lesson_filter" %>
      <%= text_field_tag :search,nil , class: 'lesson_search' %>
    <% end %>
    <div id="lessons-admin">
      <%= render 'lessons_admin' %>
    </div>

  </div>

  <div id="users-tab" class="tab-content">
    <h2>Users</h2>

    <%= form_tag(admin_path, method: :get, remote: true) do %>
      <%= text_field_tag :user_search, nil, class: 'user_search' %>
    <% end %>
    <div id="users-admin">
      <%= render 'users_admin' %>
    </div>

  </div>

  <div id="mailing-tab" class="tab-content">
    <h2>Mailing List</h2>
    <%= link_to 'Download', download_mailing_list_path(:format => 'csv'), class: "button button--primary" %>
    <%= form_tag(admin_path, method: :get, remote: true) do %>
      <%= text_field_tag :user_search, nil, class: 'mailer_search' %>
    <% end %>
    <div id="mailers-admin">
      <%= render 'mailers_admin' %>
    </div>

  </div>
</div>


<script>
  $(document).on('ready ajaxComplete',function(){
      console.log("ajaxComplete")
      $('.lesson_approved_check').change(function(){
        lesson = $(this).attr('data')
        approved = $(this)[0].checked
        console.log(lesson)
        console.log(approved)
        $.ajax({
          url: '',
          type: 'get',
          data: {
            lesson: lesson,
            approved: approved
          }
        })
      });

      $('.lesson_filter').on('change', function(){
        filter = $(this).val()
        $.ajax({
          url: '',
          type: 'get',
          data: {
            filter: filter
          }
        })
      });

      $('.lesson_search').on('change', function(){
        query = $(this).val()
        $.ajax({
          url: '',
          type: 'get',
          data: {
            search: query
          }
        })
      })

      $('.user_search').on('change', function(){
        query = $(this).val()
        $.ajax({
          url: '',
          type: 'get',
          data: {
            user_search: query
          }
        })
      })

      $('.mailer_search').on('change', function(){
        query = $(this).val()
        $.ajax({
          url: '',
          type: 'get',
          data: {
            mailer_search: query
          }
        })
      })

    $('ul.tabs li').click(function(){
      var tab_id = $(this).attr('data-tab');

      $('ul.tabs li').removeClass('current');
      $('.tab-content').removeClass('current');

      $(this).addClass('current');
      $("#"+tab_id).addClass('current');
    })

  })
</script>